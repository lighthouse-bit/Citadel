// server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============== ENUMS ==============

enum ArtworkStatus {
  AVAILABLE
  SOLD
  RESERVED
  NOT_FOR_SALE
}

enum ArtworkCategory {
  PAINTING
  DRAWING
  DIGITAL
  MIXED_MEDIA
  SCULPTURE
  PHOTOGRAPHY
}

enum CommissionStatus {
  PENDING
  REVIEWING
  ACCEPTED
  IN_PROGRESS
  REVISION
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  UNPAID
  DEPOSIT_PAID
  FULLY_PAID
  REFUNDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

// ============== MODELS ==============

model Artwork {
  id          String          @id @default(uuid())
  title       String
  description String          @db.Text
  price       Decimal         @db.Decimal(10, 2)
  category    ArtworkCategory
  medium      String?
  year        Int?
  
  // Dimensions
  width       Decimal?        @db.Decimal(6, 2)
  height      Decimal?        @db.Decimal(6, 2)
  depth       Decimal?        @db.Decimal(6, 2)
  unit        String          @default("inches")
  
  // Status & Display
  status      ArtworkStatus   @default(AVAILABLE)
  featured    Boolean         @default(false)
  displayOrder Int            @default(0)
  
  // SEO
  slug        String          @unique
  metaTitle   String?
  metaDesc    String?
  
  // Timestamps
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  
  // Relations
  images      ArtworkImage[]
  orderItems  OrderItem[]
  tags        ArtworkTag[]
  
  @@index([status])
  @@index([category])
  @@index([featured])
}

model ArtworkImage {
  id        String   @id @default(uuid())
  url       String
  publicId  String   // Cloudinary public ID
  isPrimary Boolean  @default(false)
  order     Int      @default(0)
  
  artworkId String
  artwork   Artwork  @relation(fields: [artworkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([artworkId])
}

model Tag {
  id       String       @id @default(uuid())
  name     String       @unique
  slug     String       @unique
  artworks ArtworkTag[]
}

model ArtworkTag {
  artworkId String
  tagId     String
  artwork   Artwork @relation(fields: [artworkId], references: [id], onDelete: Cascade)
  tag       Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@id([artworkId, tagId])
}

model Customer {
  id        String   @id @default(uuid())
  email     String   @unique
  firstName String
  lastName  String
  phone     String?
  password  String?
  
  // Stripe
  stripeCustomerId String? @unique
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  orders      Order[]
  commissions Commission[]
  addresses   Address[]
  
  @@index([email])
}

model Address {
  id         String  @id @default(uuid())
  label      String? // "Home", "Office", etc.
  line1      String
  line2      String?
  city       String
  state      String?
  postalCode String
  country    String
  isDefault  Boolean @default(false)
  
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  orders     Order[]
  
  @@index([customerId])
}

model Order {
  id              String        @id @default(uuid())
  orderNumber     String        @unique
  
  // Pricing
  subtotal        Decimal       @db.Decimal(10, 2)
  shippingCost    Decimal       @db.Decimal(10, 2) @default(0)
  tax             Decimal       @db.Decimal(10, 2) @default(0)
  total           Decimal       @db.Decimal(10, 2)
  
  // Status
  status          OrderStatus   @default(PENDING)
  paymentStatus   PaymentStatus @default(UNPAID)
  
  // Stripe
  stripePaymentIntentId String? @unique
  
  // Shipping
  shippingMethod  String?
  trackingNumber  String?
  shippedAt       DateTime?
  deliveredAt     DateTime?
  
  // Notes
  customerNotes   String?       @db.Text
  internalNotes   String?       @db.Text
  
  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  // Relations
  customerId      String
  customer        Customer      @relation(fields: [customerId], references: [id])
  
  shippingAddressId String?
  shippingAddress   Address?    @relation(fields: [shippingAddressId], references: [id])
  
  items           OrderItem[]
  
  @@index([customerId])
  @@index([status])
  @@index([orderNumber])
}

model OrderItem {
  id        String  @id @default(uuid())
  price     Decimal @db.Decimal(10, 2)
  title     String  // Snapshot of artwork title at time of purchase
  
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  artworkId String
  artwork   Artwork @relation(fields: [artworkId], references: [id])
  
  @@index([orderId])
}

model Commission {
  id              String           @id @default(uuid())
  commissionNumber String          @unique
  
  // Artwork Details
  artStyle        String
  size            String
  description     String           @db.Text
  
  // Pricing
  estimatedPrice  Decimal?         @db.Decimal(10, 2)
  finalPrice      Decimal?         @db.Decimal(10, 2)
  depositAmount   Decimal?         @db.Decimal(10, 2)
  
  // Status
  status          CommissionStatus @default(PENDING)
  paymentStatus   PaymentStatus    @default(UNPAID)
  
  // Stripe
  stripePaymentIntentId String?
  
  // Timeline
  deadline        DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  
  // Timestamps
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  customerId      String
  customer        Customer         @relation(fields: [customerId], references: [id])
  
  referenceImages CommissionImage[]
  progressImages  CommissionProgress[]
  notes           CommissionNote[]
  
  @@index([customerId])
  @@index([status])
}

model CommissionImage {
  id           String     @id @default(uuid())
  url          String
  publicId     String     // Cloudinary public ID
  originalName String
  
  commissionId String
  commission   Commission @relation(fields: [commissionId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime   @default(now())
  
  @@index([commissionId])
}

model CommissionProgress {
  id           String     @id @default(uuid())
  imageUrl     String
  publicId     String
  description  String?
  
  commissionId String
  commission   Commission @relation(fields: [commissionId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime   @default(now())
  
  @@index([commissionId])
}

model CommissionNote {
  id           String     @id @default(uuid())
  content      String     @db.Text
  isInternal   Boolean    @default(false) // Internal notes vs client-visible
  
  commissionId String
  commission   Commission @relation(fields: [commissionId], references: [id], onDelete: Cascade)
  
  createdAt    DateTime   @default(now())
  
  @@index([commissionId])
}

model Admin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed
  name      String
  role      String   @default("admin")
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([email])
}

model SiteSettings {
  id                  String  @id @default("settings")
  siteName            String  @default("Citadel")
  artistName          String?
  artistBio           String? @db.Text
  contactEmail        String?
  socialInstagram     String?
  socialTwitter       String?
  socialFacebook      String?
  commissionOpen      Boolean @default(true)
  commissionWaitTime  String? // e.g., "2-3 weeks"
  shippingInfo        String? @db.Text
  returnPolicy        String? @db.Text
}